!function(){let e,a,t,r,i,o,s,l,n,c=!1;function m(e){void 0===a&&(t=document.getElementById("simple-local-avatar-ratings"),a=jQuery(document.getElementById("simple-local-avatar-spinner")),r=document.getElementById("simple-local-avatar-photo"),i=jQuery(t).closest("form").find("input[type=submit]")),"unlock"===e?(c=!1,i.removeAttr("disabled"),a.hide()):(c=!0,i.attr("disabled","disabled"),a.show())}function p(e,a){const t=a.get("control"),r=e.get("width"),i=e.get("height");let o=parseInt(t.params.width,10),s=parseInt(t.params.height,10);const l=o/s;a.set("canSkipCrop",!t.mustBeCropped(!1,!1,o,s,r,i));const n=o,c=s;r/i>l?(s=i,o=s*l):(o=r,s=o/l);const m=(r-o)/2,p=(i-s)/2;return{handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:r,imageHeight:i,minWidth:n>o?o:n,minHeight:c>s?s:c,x1:m,y1:p,x2:o+m,y2:s+p,aspectRatio:`${o}:${s}`}}function u(e,a,i,o){const s={};s.url=e,s.thumbnail_url=e,s.timestamp=_.now(),a&&(s.attachment_id=a),i&&(s.width=i),o&&(s.height=o),m("lock"),jQuery.post(ajaxurl,{action:"assign_simple_local_avatar_media",media_id:a,user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.mediaNonce}).done((function(e){""!==e&&(r.innerHTML=e,jQuery("#simple-local-avatar-remove").show(),t.disabled=!1)})).always((function(){m("unlock")}))}jQuery(document).ready((function(a){s=a("#simple-local-avatar"),o=a("#simple-local-avatar-photo img"),n=o.attr("src"),t=a("#simple-local-avatar-ratings"),r=a("#simple-local-avatar-photo"),a("#simple-local-avatar-media").on("click",(function(a){if(a.preventDefault(),c)return;const i={id:"control-id",params:{flex_width:!1,flex_height:!1,width:200,height:200},mustBeCropped:function(e,a,t,r,i,o){return i!==t||o!==r}};e=wp.media({button:{text:i10n_SimpleLocalAvatars.selectCrop,close:!1},states:[new wp.media.controller.Library({title:i10n_SimpleLocalAvatars.selectCrop,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:200,suggestedHeight:200}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:p,control:i})]}),e.on("cropped",(function(e){const{url:a}=e;u(a,e.id,e.width,e.height)})),e.on("skippedcrop",(function(e){const a=e.get("url"),t=e.get("width"),r=e.get("height");u(a,e.id,t,r)})),e.on("select",(function(){const a=e.state().get("selection").first().toJSON();var o;i.params.width!==a.width||i.params.height!==a.height||i.params.flex_width||i.params.flex_height?e.setState("cropper"):(a.dst_width=a.width,a.dst_height=a.height,o=a,m("lock"),jQuery.post(ajaxurl,{action:"assign_simple_local_avatar_media",media_id:o.id,user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.mediaNonce}).done((function(e){""!==e&&(r.innerHTML=e,jQuery("#simple-local-avatar-remove").show(),t.disabled=!1,m("unlock"))})).always((function(){m("unlock")})),e.close())})),e.open()})),a("#simple-local-avatar-remove").on("click",(function(e){e.preventDefault(),c||(m("lock"),a.get(ajaxurl,{action:"remove_simple_local_avatar",user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.deleteNonce}).done((function(e){""!==e&&(r.innerHTML=e,a("#simple-local-avatar-remove").hide(),t.disabled=!0)})).always((function(){m("unlock")})))})),s.on("change",(function(e){o.attr("srcset",""),o.attr("height","auto"),URL.revokeObjectURL(l),e.target.files.length>0?(l=URL.createObjectURL(e.target.files[0]),o.attr("src",l)):o.attr("src",n)})),a(document.getElementById("simple-local-avatars-migrate-from-wp-user-avatar")).on("click",(function(e){e.preventDefault(),jQuery.post(ajaxurl,{action:"migrate_from_wp_user_avatar",migrateFromWpUserAvatarNonce:i10n_SimpleLocalAvatars.migrateFromWpUserAvatarNonce}).always((function(){a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").empty(),a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").text(i10n_SimpleLocalAvatars.migrateFromWpUserAvatarProgress)})).done((function(e){a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").empty();const t=a.parseJSON(e).count;0===t&&a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").text(i10n_SimpleLocalAvatars.migrateFromWpUserAvatarFailure),t>0&&a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").text(i10n_SimpleLocalAvatars.migrateFromWpUserAvatarSuccess+": "+t),setTimeout((function(){a(".simple-local-avatars-migrate-from-wp-user-avatar-progress").empty()}),5e3)}))}))}))}();